*************************************************
  RobotPy: Python for FRC cRIO Robot Controller
*************************************************

:Author: Peter Johnson, FRC Team 294
:Copyright: Copyright © 2010, Peter Johnson, Ross Light

About RobotPy
===============

RobotPy is a distribution of `Python`_ intended to be used for the `FIRST
Robotics Competition`_.  Teams can use this to write their robot code in
Python, a powerful dynamic programming language.

.. _Python: http://www.python.org/
.. _FIRST Robotics Competition: http://www.usfirst.org/

Features
==========

*  `Python`_ is simple to learn and easy to maintain.
*  RobotPy lets you reload code without restarting.
*  RobotPy provides access to the WPILib class library.
*  You don't need to use WindRiver once the base code is installed.

Installation
==============

If you downloaded a release .zip file:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Unzip the release .zip to a temporary directory.

Connect to your robot's IP with an FTP client (e.g. ``ftp://10.XX.YY.2/``,
where XXYY is your team number).  Copy all files and directories in the
distribution's ``robot`` directory to the root (top level) directory on the
robot.  Note: this will overwrite any UserProgram.out currently on the robot
with the Python interpreter.

If you cloned the git repository:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Open the project directory as a WindRiver project.  Build the project and
download the code to your robot.  Now you have the Python interpreter on the
robot.

Connect to your robot's IP with an FTP client (e.g. ``ftp://10.XX.YY.2/``,
where XXYY is your team number).  Copy the ``Python\Lib`` directory tree to
``/lib/python3.1`` on the robot.  Copy the ``py\boot.py`` file to
``/py/boot.py`` on the robot.  This is the bootloader which will run the rest
of your code; you shouldn't need to edit it.

Writing Code
==============

The default Python bootloader will load ``/py/robot.py`` and try to call a
function called ``run`` in there.  A basic ``robot.py`` file may look like
this::

  -- samples/template/robot.py
  import wpilib

  stick1 = wpilib.Joystick(1)

  def checkRestart():
      if stick1.GetRawButton(10):
          raise RuntimeError("Restart")

  def disabled():
      while wpilib.IsDisabled():
          checkRestart()
          wpilib.Wait(0.01)

  def autonomous():
      while wpilib.IsAutonomous() and wpilib.IsEnabled():
          checkRestart()
          wpilib.Wait(0.01)

  def teleop():
      while wpilib.IsOperatorControl() and wpilib.IsEnabled():
          checkRestart()
          wpilib.Wait(0.01)

  def run():
      """Main loop"""
      while 1:
          if wpilib.IsDisabled():
              print("Running disabled()")
              disabled()
              while wpilib.IsDisabled():
                  wpilib.Wait(0.01)
          elif wpilib.IsAutonomous():
              print("Running autonomous()")
              autonomous()
              while wpilib.IsAutonomous() and wpilib.IsEnabled():
                  wpilib.Wait(0.01)
          else:
              print("Running teleop()")
              teleop()
              while wpilib.IsOperatorControl() and wpilib.IsEnabled():
                  wpilib.Wait(0.01)

The above code exits (via a RuntimeError exception) if Joystick 1's button
#10 is pressed.  This is to facilitate code reloads; after copying a new
``robot.py`` to your robot, pressing this joystick button will exit the old
version, wait 5 seconds, and then load your new ``robot.py``.

You can find this and other examples of code in the ``samples`` directory.

Technical Overview
====================

RobotPy is a packaging of a patched `Python`_ 3.1.2 interpreter (found in the
``Python`` subdirectory of the source code).  All access to the WPILib is
generated by a `SWIG`_ interface, which is found at ``wpilib.i``.  When the
robot is started, it calls upon the PyRobot class to set up the environment,
which initializes the Python interpreter and runs the file ``py/boot.py``.
From there, all responsibility is given to the ``boot.py`` script, which is
referred to as the bootloader.

If ``boot.py`` ever exits (due to an exception, for example), the PyRobot
class waits 5 seconds and then restarts ``boot.py``.  This is how code
reloads are performed.  Note: because of the way code reloads are performed,
changes to ``boot.py`` and parts of the Python system library (files in
lib/python3.1) require a full robot reboot (e.g. power cycle) to reload.

RobotPy uses the same SWIG wrappers for WPILib as the `FIRST Lua`_ project,
created by Ross Light, FRC Team 973.

.. _SWIG: http://www.swig.org/
.. _FIRST Lua: http://redmine.zombiezen.com/projects/firstlua/

Major Differences from standard Python
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

*  No dynamic loading of C code.  vxWorks does have the capability for it, but
   we haven't seen a need to introduce the complexity.  This restriction may be
   lifted eventually.
*  Several Python modules with large and/or incompatible dependencies removed,
   namely: curses, dbm, gdbm, tkinter, nis, ossaudiodev, readline, resource,
   spwd, syslog, termios, audioop, bz2, crypt, grp, ssl, pwd, and mmap.

Licensing
===========

A brief overview of licensing terms:

*  `Python`_: `PSF License`_
*  RobotPy (all other support code): `MIT License`_

.. _PSF License: http://docs.python.org/license.html
.. _MIT License: http://www.opensource.org/licenses/mit-license.php

If you redistribute RobotPy and add other libraries, please include their
licensing information here.

RobotPy
~~~~~~~~~

Copyright © 2010 Peter Johnson

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

WPILib SWIG Wrappers
~~~~~~~~~~~~~~~~~~~~~~

Copyright © 2010 Ross Light

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

.. vim: tw=80 et ts=3 sw=3 ft=rst fenc=utf-8
